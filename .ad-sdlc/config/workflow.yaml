# AD-SDLC Workflow Configuration
# Agent-Driven Software Development Lifecycle System

version: "1.0.0"
name: "AD-SDLC Workflow"

# =============================================================================
# Global Settings
# =============================================================================
global:
  project_root: "${PWD}"
  scratchpad_dir: ".ad-sdlc/scratchpad"
  output_docs_dir: "docs"
  log_level: "INFO"  # DEBUG, INFO, WARN, ERROR

  # Approval mode for pipeline execution
  # - "auto": No approval prompts, fully automated execution (default)
  # - "manual": Approval required at every gate
  # - "critical": Only critical stages require approval (before_merge, after_sds)
  # - "custom": Use individual approval_gates settings below
  approval_mode: "auto"

  # Human-in-the-loop approval gates
  # Only used when approval_mode is "custom"
  # Set to true to enable manual review at each stage
  # Keys match actual pipeline stage names in modes.*.stages[].name
  approval_gates:
    # Greenfield Pipeline stages
    collection: false           # After collector agent
    prd_generation: false       # After PRD writer
    srs_generation: false       # After SRS writer
    repo_detection: false       # After repo detector
    github_repo_setup: false    # After GitHub repo setup
    sds_generation: false       # After SDS writer
    issue_generation: false     # After issue generator
    review: false               # Before PR merge
    # Enhancement Pipeline stages
    doc_code_comparison: false  # After gap analysis
    impact_analysis: false      # After impact assessment
    prd_update: false           # After PRD updater
    srs_update: false           # After SRS updater
    sds_update: false           # After SDS updater
    # Import Pipeline stages
    issue_reading: false        # After issue import

  # Retry policy for agents
  retry_policy:
    max_attempts: 3
    backoff: "exponential"
    base_delay_seconds: 5
    max_delay_seconds: 60

  # Timeout settings
  timeouts:
    document_generation: 300  # 5 minutes
    issue_creation: 60
    implementation: 1800  # 30 minutes
    pr_review: 300

# =============================================================================
# Pipeline Mode Selection
# =============================================================================
# Mode is determined by mode-detector agent or can be overridden by user
# See mode-detection.yaml for detection rules and thresholds

# =============================================================================
# Pipeline Stages by Mode
# =============================================================================
pipeline:
  # Default mode (can be overridden by user or auto-detected)
  default_mode: "greenfield"

  modes:
    # =========================================================================
    # Greenfield Mode - Full document generation pipeline for new projects
    # =========================================================================
    greenfield:
      description: "Full document generation pipeline for new projects"
      stages:
        - name: "collection"
          agent: "collector"
          description: "Collect and structure user requirements"
          inputs:
            - type: "user_message"
            - type: "files"
            - type: "urls"
          outputs:
            - "${scratchpad_dir}/info/${project_id}/collected_info.yaml"
          next: "prd_generation"
          approval_required: true

        - name: "prd_generation"
          agent: "prd-writer"
          description: "Generate PRD from collected information"
          inputs:
            - "${scratchpad_dir}/info/${project_id}/collected_info.yaml"
          outputs:
            - "${scratchpad_dir}/documents/${project_id}/prd.md"
            - "${output_docs_dir}/prd/PRD-${project_id}.md"
          next: "srs_generation"
          approval_required: true

        - name: "srs_generation"
          agent: "srs-writer"
          description: "Generate SRS from PRD"
          inputs:
            - "${scratchpad_dir}/documents/${project_id}/prd.md"
          outputs:
            - "${scratchpad_dir}/documents/${project_id}/srs.md"
            - "${output_docs_dir}/srs/SRS-${project_id}.md"
          next: "repo_detection"
          approval_required: true

        - name: "repo_detection"
          agent: "repo-detector"
          description: "Detect existing GitHub repository presence"
          inputs:
            - "${scratchpad_dir}/documents/${project_id}/prd.md"
          outputs:
            - "${scratchpad_dir}/repo/${project_id}/detection_result.yaml"
          next: "github_repo_setup"
          approval_required: false
          conditional: true  # Skip github_repo_setup if repo already exists

        - name: "github_repo_setup"
          agent: "github-repo-setup"
          description: "Create and initialize public GitHub repository"
          inputs:
            - "${scratchpad_dir}/documents/${project_id}/prd.md"
            - "${scratchpad_dir}/documents/${project_id}/srs.md"
          outputs:
            - "${scratchpad_dir}/repo/${project_id}/github_repo.yaml"
          next: "sds_generation"
          approval_required: true

        - name: "sds_generation"
          agent: "sds-writer"
          description: "Generate SDS from SRS"
          inputs:
            - "${scratchpad_dir}/documents/${project_id}/srs.md"
          outputs:
            - "${scratchpad_dir}/documents/${project_id}/sds.md"
            - "${output_docs_dir}/sds/SDS-${project_id}.md"
          next: "issue_generation"
          approval_required: true

        - name: "issue_generation"
          agent: "issue-generator"
          description: "Generate GitHub issues from SDS"
          inputs:
            - "${scratchpad_dir}/documents/${project_id}/sds.md"
          outputs:
            - "${scratchpad_dir}/issues/${project_id}/issue_list.json"
            - "${scratchpad_dir}/issues/${project_id}/dependency_graph.json"
          next: "orchestration"
          approval_required: true

        - name: "orchestration"
          agent: "controller"
          description: "Orchestrate work distribution"
          inputs:
            - "${scratchpad_dir}/issues/${project_id}/issue_list.json"
            - "${scratchpad_dir}/issues/${project_id}/dependency_graph.json"
          outputs:
            - "${scratchpad_dir}/progress/${project_id}/controller_state.yaml"
            - "${scratchpad_dir}/progress/${project_id}/work_orders/*.yaml"
          next: "implementation"
          approval_required: false

        - name: "implementation"
          agent: "worker"
          description: "Implement assigned issues"
          parallel: true
          max_parallel: 5
          inputs:
            - "${scratchpad_dir}/progress/${project_id}/work_orders/*.yaml"
          outputs:
            - "${scratchpad_dir}/progress/${project_id}/results/*.yaml"
            - "src/**/*"
          next: "review"
          approval_required: false

        - name: "review"
          agent: "pr-reviewer"
          description: "Create and review PRs"
          inputs:
            - "${scratchpad_dir}/progress/${project_id}/results/*.yaml"
          outputs:
            - "${scratchpad_dir}/progress/${project_id}/reviews/*.yaml"
          next: null  # End of pipeline
          approval_required: false
          on_ci_failure:
            agent: "ci-fixer"
            description: "Automatically diagnose and fix CI/CD failures"
            max_attempts: 3
            inputs:
              - "${scratchpad_dir}/progress/${project_id}/reviews/*.yaml"
            outputs:
              - "${scratchpad_dir}/progress/${project_id}/ci_fixes/*.yaml"

    # =========================================================================
    # Enhancement Mode - Incremental update pipeline for existing projects
    # =========================================================================
    enhancement:
      description: "Incremental update pipeline for existing projects"
      stages:
        - name: "analysis_parallel"
          description: "Parallel analysis of existing documents and codebase"
          parallel: true
          substages:
            - name: "document_reading"
              agent: "document-reader"
              description: "Parse existing PRD/SRS/SDS documents"
              inputs:
                - type: "existing_documents"
                - "${output_docs_dir}/prd/*.md"
                - "${output_docs_dir}/srs/*.md"
                - "${output_docs_dir}/sds/*.md"
              outputs:
                - "${scratchpad_dir}/current_state/${project_id}/current_state.yaml"
              approval_required: false

            - name: "codebase_analysis"
              agent: "codebase-analyzer"
              description: "Analyze existing codebase structure"
              inputs:
                - type: "source_code"
                - "src/**/*"
                - "package.json"
                - "tsconfig.json"
              outputs:
                - "${scratchpad_dir}/analysis/${project_id}/architecture_overview.yaml"
                - "${scratchpad_dir}/analysis/${project_id}/dependency_graph.json"
              approval_required: false

            - name: "code_reading"
              agent: "code-reader"
              description: "Analyze source code AST for classes, functions, and dependencies"
              inputs:
                - type: "source_code"
                - "src/**/*"
              outputs:
                - "${scratchpad_dir}/analysis/${project_id}/code_inventory.yaml"
              approval_required: false
          next: "doc_code_comparison"

        - name: "doc_code_comparison"
          agent: "doc-code-comparator"
          description: "Compare document specifications against code implementation"
          inputs:
            - "${scratchpad_dir}/current_state/${project_id}/current_state.yaml"
            - "${scratchpad_dir}/analysis/${project_id}/code_inventory.yaml"
            - "${scratchpad_dir}/analysis/${project_id}/architecture_overview.yaml"
          outputs:
            - "${scratchpad_dir}/analysis/${project_id}/gap_report.yaml"
          next: "impact_analysis"
          approval_required: false

        - name: "impact_analysis"
          agent: "impact-analyzer"
          description: "Analyze change impact on existing system"
          inputs:
            - type: "user_message"
            - "${scratchpad_dir}/current_state/${project_id}/current_state.yaml"
            - "${scratchpad_dir}/analysis/${project_id}/architecture_overview.yaml"
            - "${scratchpad_dir}/analysis/${project_id}/dependency_graph.json"
          outputs:
            - "${scratchpad_dir}/impact/${project_id}/impact_report.yaml"
          next: "document_update"
          approval_required: true  # Human review of impact analysis

        - name: "document_update"
          description: "Sequential document updates (PRD → SRS → SDS)"
          substages:
            - name: "prd_update"
              agent: "prd-updater"
              description: "Incrementally update PRD"
              inputs:
                - "${output_docs_dir}/prd/*.md"
                - "${scratchpad_dir}/impact/${project_id}/impact_report.yaml"
              outputs:
                - "${scratchpad_dir}/documents/${project_id}/prd_update_result.yaml"
                - "${output_docs_dir}/prd/PRD-${project_id}.md"
                - "${output_docs_dir}/prd/prd_changelog.md"
              next: "srs_update"
              approval_required: true

            - name: "srs_update"
              agent: "srs-updater"
              description: "Incrementally update SRS"
              inputs:
                - "${output_docs_dir}/srs/*.md"
                - "${scratchpad_dir}/documents/${project_id}/prd_update_result.yaml"
              outputs:
                - "${scratchpad_dir}/documents/${project_id}/srs_update_result.yaml"
                - "${output_docs_dir}/srs/SRS-${project_id}.md"
                - "${output_docs_dir}/srs/srs_changelog.md"
              next: "sds_update"
              approval_required: true

            - name: "sds_update"
              agent: "sds-updater"
              description: "Incrementally update SDS"
              inputs:
                - "${output_docs_dir}/sds/*.md"
                - "${scratchpad_dir}/documents/${project_id}/srs_update_result.yaml"
              outputs:
                - "${scratchpad_dir}/documents/${project_id}/sds_update_result.yaml"
                - "${output_docs_dir}/sds/SDS-${project_id}.md"
                - "${output_docs_dir}/sds/sds_changelog.md"
              approval_required: true
          next: "issue_generation"

        - name: "issue_generation"
          agent: "issue-generator"
          description: "Generate issues from updated SDS and impact report"
          inputs:
            - "${scratchpad_dir}/documents/${project_id}/sds_update_result.yaml"
            - "${scratchpad_dir}/impact/${project_id}/impact_report.yaml"
          outputs:
            - "${scratchpad_dir}/issues/${project_id}/issue_list.json"
            - "${scratchpad_dir}/issues/${project_id}/dependency_graph.json"
          next: "orchestration"
          approval_required: true

        - name: "orchestration"
          agent: "controller"
          description: "Orchestrate work distribution"
          inputs:
            - "${scratchpad_dir}/issues/${project_id}/issue_list.json"
            - "${scratchpad_dir}/issues/${project_id}/dependency_graph.json"
          outputs:
            - "${scratchpad_dir}/progress/${project_id}/controller_state.yaml"
            - "${scratchpad_dir}/progress/${project_id}/work_orders/*.yaml"
          next: "parallel_execution"
          approval_required: false

        - name: "parallel_execution"
          description: "Parallel execution of implementation and regression testing"
          parallel: true
          substages:
            - name: "implementation"
              agent: "worker"
              description: "Implement assigned issues"
              parallel: true
              max_parallel: 5
              inputs:
                - "${scratchpad_dir}/progress/${project_id}/work_orders/*.yaml"
              outputs:
                - "${scratchpad_dir}/progress/${project_id}/results/*.yaml"
                - "src/**/*"
              approval_required: false

            - name: "regression_testing"
              agent: "regression-tester"
              description: "Run regression tests for affected areas"
              inputs:
                - "${scratchpad_dir}/progress/${project_id}/results/*.yaml"
                - "${scratchpad_dir}/analysis/${project_id}/dependency_graph.json"
              outputs:
                - "${scratchpad_dir}/progress/${project_id}/regression_report.yaml"
              approval_required: false
          next: "review"

        - name: "review"
          agent: "pr-reviewer"
          description: "Create and review PRs with regression report"
          inputs:
            - "${scratchpad_dir}/progress/${project_id}/results/*.yaml"
            - "${scratchpad_dir}/progress/${project_id}/regression_report.yaml"
          outputs:
            - "${scratchpad_dir}/progress/${project_id}/reviews/*.yaml"
          next: null  # End of pipeline
          approval_required: false
          on_ci_failure:
            agent: "ci-fixer"
            description: "Automatically diagnose and fix CI/CD failures"
            max_attempts: 3
            inputs:
              - "${scratchpad_dir}/progress/${project_id}/reviews/*.yaml"
            outputs:
              - "${scratchpad_dir}/progress/${project_id}/ci_fixes/*.yaml"

    # =========================================================================
    # Import Mode - Start from existing GitHub issues
    # =========================================================================
    import:
      description: "Import existing GitHub issues and start execution pipeline"
      stages:
        - name: "issue_reading"
          agent: "issue-reader"
          description: "Import existing GitHub issues to AD-SDLC format"
          inputs:
            - type: "github_issues"
            - type: "filter_criteria"
          outputs:
            - "${scratchpad_dir}/issues/${project_id}/issue_list.json"
            - "${scratchpad_dir}/issues/${project_id}/dependency_graph.json"
          next: "orchestration"
          approval_required: true

        - name: "orchestration"
          agent: "controller"
          description: "Orchestrate work distribution from imported issues"
          inputs:
            - "${scratchpad_dir}/issues/${project_id}/issue_list.json"
            - "${scratchpad_dir}/issues/${project_id}/dependency_graph.json"
          outputs:
            - "${scratchpad_dir}/progress/${project_id}/controller_state.yaml"
            - "${scratchpad_dir}/progress/${project_id}/work_orders/*.yaml"
          next: "implementation"
          approval_required: false

        - name: "implementation"
          agent: "worker"
          description: "Implement assigned issues"
          parallel: true
          max_parallel: 5
          inputs:
            - "${scratchpad_dir}/progress/${project_id}/work_orders/*.yaml"
          outputs:
            - "${scratchpad_dir}/progress/${project_id}/results/*.yaml"
            - "src/**/*"
          next: "review"
          approval_required: false

        - name: "review"
          agent: "pr-reviewer"
          description: "Create and review PRs"
          inputs:
            - "${scratchpad_dir}/progress/${project_id}/results/*.yaml"
          outputs:
            - "${scratchpad_dir}/progress/${project_id}/reviews/*.yaml"
          next: null  # End of pipeline
          approval_required: false
          on_ci_failure:
            agent: "ci-fixer"
            description: "Automatically diagnose and fix CI/CD failures"
            max_attempts: 3
            inputs:
              - "${scratchpad_dir}/progress/${project_id}/reviews/*.yaml"
            outputs:
              - "${scratchpad_dir}/progress/${project_id}/ci_fixes/*.yaml"

  # Legacy compatibility: stages array for backward compatibility
  # When no mode is specified, this defaults to greenfield stages
  stages: []  # Use modes.greenfield.stages, modes.enhancement.stages, or modes.import.stages

# =============================================================================
# Agent Configurations
# =============================================================================
agents:
  collector:
    model: "sonnet"
    tools:
      - Read
      - WebFetch
      - WebSearch
      - Grep
      - Glob
      - Write
    max_questions: 5  # Max clarifying questions before proceeding

  prd-writer:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Edit
      - Glob
      - Grep
    template: ".ad-sdlc/templates/prd-template.md"
    quality_gate_ref: "quality_gates.document_quality.prd"
    timeout_ref: "global.timeouts.document_generation"  # 300s
    retry_ref: "global.retry_policy"

  srs-writer:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Edit
      - Glob
      - Grep
    template: ".ad-sdlc/templates/srs-template.md"
    quality_gate_ref: "quality_gates.document_quality.srs"
    timeout_ref: "global.timeouts.document_generation"
    retry_ref: "global.retry_policy"

  github-repo-setup:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Edit
      - Glob
      - Grep
      - Bash
    repository:
      visibility: "public"
      default_branch: "main"
      default_license: "MIT"
    github:
      require_auth: true
      add_topics: true

  sds-writer:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Edit
      - Glob
      - Grep
    template: ".ad-sdlc/templates/sds-template.md"
    quality_gate_ref: "quality_gates.document_quality.sds"
    timeout_ref: "global.timeouts.document_generation"
    retry_ref: "global.retry_policy"

  issue-generator:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Bash
      - Glob
      - Grep
    template: ".ad-sdlc/templates/issue-template.md"
    github:
      labels_prefix: "ad-sdlc"
      auto_assign: false

  issue-reader:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Bash
      - Glob
      - Grep
    github:
      default_state: "open"
      max_issues: 500
    priority_mapping:
      critical: "P0"
      priority-p0: "P0"
      high: "P1"
      priority-p1: "P1"
      medium: "P2"
      priority-p2: "P2"
      low: "P3"
      priority-p3: "P3"
    effort_mapping:
      "size:XS": 2
      "size:S": 4
      "size:M": 6
      "size:L": 12
      "size:XL": 20

  controller:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Edit
      - Bash
      - Glob
      - Grep
    scheduling:
      algorithm: "priority_dependency"  # priority_only, dependency_only, priority_dependency
      max_workers: 5
      check_interval_seconds: 30

  worker:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Edit
      - Bash
      - Glob
      - Grep
    coding:
      language: "typescript"  # Adjust per project
      test_framework: "vitest"
      lint_command: "npm run lint"
      test_command: "npm test"
      build_command: "npm run build"
    verification:
      run_tests: true
      run_lint: true
      run_build: true
      coverage_threshold: 80  # References quality_gates.code_quality.coverage_threshold
    quality_gate_ref: "quality_gates.code_quality"  # Enforced before submitting results
    timeout_ref: "global.timeouts.implementation"  # 1800s
    retry_ref: "global.retry_policy"  # max 3 attempts, exponential backoff

  pr-reviewer:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Edit
      - Bash
      - Glob
      - Grep
    review:
      auto_merge: false
      require_all_checks: true
      coverage_threshold: 80  # References quality_gates.code_quality.coverage_threshold
      max_complexity: 10  # References quality_gates.code_quality.max_complexity
    github:
      merge_strategy: "squash"  # merge, squash, rebase
      delete_branch_after_merge: true
    quality_gate_ref: "quality_gates.code_quality"  # Enforced before merge decision
    security_gate_ref: "quality_gates.security"  # Enforced: no hardcoded secrets
    timeout_ref: "global.timeouts.pr_review"  # 300s
    retry_ref: "global.retry_policy"  # max 3 attempts, exponential backoff

  # ---------------------------------------------------------------------------
  # Enhancement Pipeline Agent Configurations
  # ---------------------------------------------------------------------------
  document-reader:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Glob
      - Grep
    parsing:
      supported_formats:
        - markdown
        - yaml
      extract_ids: true
      build_traceability: true

  codebase-analyzer:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Glob
      - Grep
      - Bash
    analysis:
      languages:
        - typescript
        - javascript
        - python
      detect_patterns: true
      generate_metrics: true
      max_depth: 10

  impact-analyzer:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Glob
      - Grep
    risk_scoring:
      enabled: true
      factors:
        - code_complexity
        - dependency_count
        - test_coverage
        - change_scope

  prd-updater:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Edit
      - Glob
      - Grep
    update_modes:
      - add_requirement
      - modify_requirement
      - deprecate_requirement
      - extend_scope
    version_management:
      auto_increment: true
      generate_changelog: true

  srs-updater:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Edit
      - Glob
      - Grep
    update_modes:
      - add_feature
      - add_use_case
      - modify_feature
      - update_interface
      - update_traceability
    traceability:
      maintain_prd_links: true
      auto_update_matrix: true

  sds-updater:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Edit
      - Glob
      - Grep
    update_modes:
      - add_component
      - add_api
      - modify_component
      - update_data_model
      - update_architecture
    traceability:
      maintain_srs_links: true
      auto_update_matrix: true

  regression-tester:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Glob
      - Grep
      - Bash
    testing:
      run_affected_tests: true
      coverage_analysis: true
      compatibility_check: true
    thresholds:
      min_coverage: 80
      max_regression_risk: "medium"

  repo-detector:
    model: "haiku"
    tools:
      - Read
      - Bash
      - Glob
    detection:
      check_remote: true
      check_local_git: true

  code-reader:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Glob
      - Grep
    analysis:
      extract_classes: true
      extract_functions: true
      extract_interfaces: true
      extract_dependencies: true

  doc-code-comparator:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Glob
      - Grep
    comparison:
      generate_gap_report: true
      auto_create_issues: false

  ci-fixer:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Edit
      - Bash
      - Glob
      - Grep
    fix_categories:
      - lint_errors
      - type_errors
      - test_failures
      - build_failures
    max_fix_attempts: 3

  analysis-orchestrator:
    model: "sonnet"
    tools:
      - Read
      - Write
      - Glob
      - Grep
      - Bash
    pipeline:
      steps:
        - "document-reader"
        - "code-reader"
        - "doc-code-comparator"
        - "issue-generator"

# =============================================================================
# Quality Gates
# =============================================================================
quality_gates:
  document_quality:
    prd:
      required_sections:
        - executive_summary
        - problem_statement
        - functional_requirements
        - non_functional_requirements
      min_requirements: 3

    srs:
      required_sections:
        - system_features
        - use_cases
        - traceability_matrix
      min_features: 1
      min_use_cases_per_feature: 1

    sds:
      required_sections:
        - system_architecture
        - component_design
        - api_specification
      min_components: 1

  code_quality:
    coverage_threshold: 80
    max_complexity: 10
    max_line_length: 100
    no_todos_in_code: false
    no_console_logs: true

  security:
    no_hardcoded_secrets: true
    require_input_validation: true
    require_authentication: true

# =============================================================================
# Notifications
# =============================================================================
notifications:
  enabled: false  # Set to true to enable
  channels:
    - type: "slack"
      webhook: "${SLACK_WEBHOOK_URL}"
      events:
        - stage_complete
        - approval_required
        - error

    - type: "email"
      recipients:
        - "${NOTIFICATION_EMAIL}"
      events:
        - approval_required
        - pipeline_complete

  templates:
    stage_complete: "Stage '${stage}' completed successfully."
    approval_required: "Approval required for stage '${stage}'. Review: ${url}"
    error: "Error in stage '${stage}': ${error_message}"

# =============================================================================
# GitHub Integration
# =============================================================================
github:
  repo: "${GITHUB_REPO}"  # owner/repo format
  default_branch: "main"
  issue_labels:
    - "ad-sdlc:auto-generated"
  pr_labels:
    - "ad-sdlc:auto-generated"
  milestone_prefix: "AD-SDLC"

# =============================================================================
# Token Budgets
# =============================================================================
# Per-agent token budget configuration for cost control and monitoring
#
# Model Assignment Priority Rules (highest to lowest):
#   1. Agent-specific `model` in workflow.yaml agents section (e.g., agents.worker.model)
#   2. Agent-specific `model_preference` in agents.yaml (e.g., agents.orchestrator.model_preference)
#   3. Category default in token_budgets.defaults (e.g., defaults.document)
#   4. Global default_model below
#
# Example resolution:
#   - worker has model: "sonnet" in workflow.yaml → uses Sonnet
#   - orchestrator has model_preference: "opus" in agents.yaml → uses Opus
#   - new agent with no override → uses default_model (opus)
token_budgets:
  # Default model preference for all agents
  default_model: "opus"  # claude-opus-4-6

  # Pipeline-level limits (aggregate of all agents)
  # High enough to allow multiple agents with 150000 tokens each
  pipeline:
    max_tokens: 1500000
    max_cost_usd: 50.00
    warning_threshold: 0.8  # 80% warning

  # Default limits by agent category
  defaults:
    document:
      max_tokens: 150000
      max_cost_usd: 3.00
    execution:
      max_tokens: 150000
      max_cost_usd: 3.00
    analysis:
      max_tokens: 150000
      max_cost_usd: 3.00
    infrastructure:
      max_tokens: 50000
      max_cost_usd: 1.00

  # Agent-specific overrides (optional)
  agents:
    sds-writer:
      max_tokens: 150000  # Complex design docs
      max_cost_usd: 3.00
    worker:
      max_tokens: 150000  # Heavy implementation work
      max_cost_usd: 3.00
    collector:
      max_tokens: 150000  # Multi-source collection
      max_cost_usd: 3.00

# =============================================================================
# Logging & Monitoring
# =============================================================================
logging:
  level: "INFO"
  format: "json"
  output:
    - type: "file"
      path: ".ad-sdlc/logs/ad-sdlc.log"
      rotate: true
      max_size: "10MB"
      max_files: 5

    - type: "console"
      format: "pretty"

  include:
    - agent_name
    - stage
    - timestamp
    - duration
    - status

monitoring:
  enabled: true
  metrics:
    - stage_duration
    - agent_invocations
    - success_rate
    - issues_created
    - prs_merged
