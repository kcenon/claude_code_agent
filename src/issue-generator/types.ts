/**
 * Issue Generator module type definitions
 *
 * Defines types for SDS parsing, issue generation, and dependency mapping.
 */

/**
 * Effort size categories for issue estimation
 */
export type EffortSize = 'XS' | 'S' | 'M' | 'L' | 'XL';

/**
 * Issue type categories
 */
export type IssueType = 'feature' | 'enhancement' | 'bug' | 'docs' | 'chore';

/**
 * Priority levels for issues
 */
export type Priority = 'P0' | 'P1' | 'P2' | 'P3';

/**
 * Dependency relationship types
 */
export type DependencyType = 'blocked_by' | 'blocks' | 'related';

/**
 * SDS component extracted from the document
 */
export interface SDSComponent {
  /** Component identifier (e.g., CMP-001) */
  readonly id: string;
  /** Component name */
  readonly name: string;
  /** Primary responsibility */
  readonly responsibility: string;
  /** Source feature reference (e.g., SF-001) */
  readonly sourceFeature: string | null;
  /** Priority level */
  readonly priority: Priority;
  /** Component description */
  readonly description: string;
  /** Interface definitions */
  readonly interfaces: readonly SDSInterface[];
  /** Dependencies on other components */
  readonly dependencies: readonly string[];
  /** Implementation notes */
  readonly implementationNotes: string;
}

/**
 * Interface definition from SDS component
 */
export interface SDSInterface {
  /** Interface name */
  readonly name: string;
  /** Methods defined in the interface */
  readonly methods: readonly SDSMethod[];
  /** Raw interface code */
  readonly rawCode: string;
}

/**
 * Method definition from SDS interface
 */
export interface SDSMethod {
  /** Method name */
  readonly name: string;
  /** Method signature */
  readonly signature: string;
  /** Return type */
  readonly returnType: string;
}

/**
 * Parsed SDS document structure
 */
export interface ParsedSDS {
  /** Document metadata */
  readonly metadata: SDSMetadata;
  /** Extracted components */
  readonly components: readonly SDSComponent[];
  /** Technology stack */
  readonly technologyStack: readonly TechnologyEntry[];
  /** Traceability matrix entries */
  readonly traceabilityMatrix: readonly TraceabilityEntry[];
}

/**
 * SDS document metadata
 */
export interface SDSMetadata {
  /** Document ID */
  readonly documentId: string;
  /** Source SRS reference */
  readonly sourceSRS: string;
  /** Source PRD reference */
  readonly sourcePRD: string;
  /** Document version */
  readonly version: string;
  /** Document status */
  readonly status: string;
  /** Creation date */
  readonly createdDate: string;
  /** Last update date */
  readonly updatedDate: string;
}

/**
 * Technology stack entry
 */
export interface TechnologyEntry {
  /** Technology layer */
  readonly layer: string;
  /** Technology name */
  readonly technology: string;
  /** Technology version */
  readonly version: string;
  /** Rationale for choice */
  readonly rationale: string;
}

/**
 * Traceability matrix entry
 */
export interface TraceabilityEntry {
  /** Component ID */
  readonly componentId: string;
  /** SRS feature reference */
  readonly srsFeature: string;
  /** Use case references */
  readonly useCases: readonly string[];
  /** PRD requirement reference */
  readonly prdRequirement: string;
}

/**
 * Generated GitHub issue structure
 */
export interface GeneratedIssue {
  /** Internal issue identifier */
  readonly issueId: string;
  /** GitHub issue number (filled after creation) */
  readonly githubNumber: number | null;
  /** Issue title */
  readonly title: string;
  /** Issue body in markdown */
  readonly body: string;
  /** Issue labels */
  readonly labels: IssueLabels;
  /** Milestone name */
  readonly milestone: string | null;
  /** Assignees (may be empty) */
  readonly assignees: readonly string[];
  /** Dependency relationships */
  readonly dependencies: IssueDependencies;
  /** Traceability links */
  readonly traceability: IssueTraceability;
  /** Technical guidance */
  readonly technical: IssueTechnical;
  /** Effort estimation */
  readonly estimation: IssueEstimation;
}

/**
 * Issue labels structure
 */
export interface IssueLabels {
  /** Issue type */
  readonly type: IssueType;
  /** Priority level */
  readonly priority: Priority;
  /** Component name */
  readonly component: string;
  /** Effort size */
  readonly size: EffortSize;
  /** Auto-generated marker */
  readonly autoGenerated: boolean;
  /** Phase label */
  readonly phase: string | null;
}

/**
 * Issue dependency relationships
 */
export interface IssueDependencies {
  /** Issues this is blocked by */
  readonly blockedBy: readonly string[];
  /** Issues this blocks */
  readonly blocks: readonly string[];
}

/**
 * Issue traceability links
 */
export interface IssueTraceability {
  /** Source SDS component */
  readonly sdsComponent: string;
  /** Source SRS feature */
  readonly srsFeature: string | null;
  /** Source PRD requirement */
  readonly prdRequirement: string | null;
  /** Related use cases */
  readonly useCases: readonly string[];
}

/**
 * Issue technical guidance
 */
export interface IssueTechnical {
  /** Suggested implementation steps */
  readonly suggestedApproach: readonly string[];
  /** Related files and their purposes */
  readonly relatedFiles: readonly RelatedFileEntry[];
  /** Additional considerations */
  readonly considerations: string;
}

/**
 * Related file entry
 */
export interface RelatedFileEntry {
  /** File path */
  readonly path: string;
  /** Purpose of the file */
  readonly purpose: string;
}

/**
 * Issue effort estimation
 */
export interface IssueEstimation {
  /** Effort size category */
  readonly size: EffortSize;
  /** Estimated hours */
  readonly hours: number;
  /** Estimation factors */
  readonly factors: EstimationFactors;
}

/**
 * Factors used in effort estimation
 */
export interface EstimationFactors {
  /** Complexity score (1-10) */
  readonly complexity: number;
  /** Number of interfaces */
  readonly interfaceCount: number;
  /** Number of dependencies */
  readonly dependencyCount: number;
  /** Number of methods */
  readonly methodCount: number;
}

/**
 * Dependency graph structure
 */
export interface DependencyGraph {
  /** Graph nodes (issues) */
  readonly nodes: readonly DependencyNode[];
  /** Graph edges (dependencies) */
  readonly edges: readonly DependencyEdge[];
  /** Execution order (topologically sorted) */
  readonly executionOrder: readonly string[];
  /** Parallelizable groups */
  readonly parallelGroups: readonly ParallelGroup[];
}

/**
 * Dependency graph node
 */
export interface DependencyNode {
  /** Issue ID */
  readonly id: string;
  /** Source component ID */
  readonly componentId: string;
  /** Node priority based on dependencies */
  readonly priority: number;
  /** Node depth in dependency tree */
  readonly depth: number;
}

/**
 * Dependency graph edge
 */
export interface DependencyEdge {
  /** Source issue ID */
  readonly from: string;
  /** Target issue ID */
  readonly to: string;
  /** Dependency type */
  readonly type: DependencyType;
}

/**
 * Group of issues that can be executed in parallel
 */
export interface ParallelGroup {
  /** Group index (execution order) */
  readonly groupIndex: number;
  /** Issue IDs in this group */
  readonly issueIds: readonly string[];
}

/**
 * Issue generation result
 */
export interface IssueGenerationResult {
  /** Generated issues */
  readonly issues: readonly GeneratedIssue[];
  /** Dependency graph */
  readonly dependencyGraph: DependencyGraph;
  /** Generation summary */
  readonly summary: GenerationSummary;
}

/**
 * Generation summary statistics
 */
export interface GenerationSummary {
  /** Total issues generated */
  readonly totalIssues: number;
  /** Issues by priority */
  readonly byPriority: Record<Priority, number>;
  /** Issues by type */
  readonly byType: Record<IssueType, number>;
  /** Issues by size */
  readonly bySize: Record<EffortSize, number>;
  /** Total estimated hours */
  readonly totalEstimatedHours: number;
  /** Components processed */
  readonly componentsProcessed: number;
  /** Generation timestamp */
  readonly generatedAt: string;
  /** Warnings during generation */
  readonly warnings: readonly string[];
}

/**
 * Issue generator configuration options
 */
export interface IssueGeneratorOptions {
  /** Maximum issue size before decomposition */
  readonly maxIssueSize?: EffortSize;
  /** Default priority for issues */
  readonly defaultPriority?: Priority;
  /** Default issue type */
  readonly defaultType?: IssueType;
  /** Project milestone */
  readonly milestone?: string;
  /** Phase label prefix */
  readonly phasePrefix?: string;
  /** Include implementation hints */
  readonly includeHints?: boolean;
  /** Include traceability links */
  readonly includeTraceability?: boolean;
}

/**
 * SDS parser options
 */
export interface SDSParserOptions {
  /** Strict mode throws on parsing errors */
  readonly strict?: boolean;
  /** Extract interfaces from code blocks */
  readonly extractInterfaces?: boolean;
  /** Parse traceability matrix */
  readonly parseTraceability?: boolean;
}
